{
  "version": 3,
  "sources": ["../src/effect.ts", "../src/system.ts", "../src/ref.ts"],
  "sourcesContent": ["export let activeSub\r\n\r\nclass ReactiveEffect {\r\n    constructor(public fn) {\r\n\r\n    }\r\n    run() {\r\n        // \u5148\u5C06\u4E4B\u524D\u7684effect\u4FDD\u5B58\u8D77\u6765  \u6CA1\u6709\u5D4C\u5957\u65F6\u5019\u5C31\u662Fundefined,\u56E0\u4E3Ajs\u662F\u5355\u7EBF\u7A0B\u7684 \u6240\u4EE5\u53EA\u6709\u4E00\u4E2AactiveSub  \u4E0A\u4E0B\u4E24\u4E2Aeffect\u4E5F\u4E0D\u5F71\u54CD\r\n        const prevSub = activeSub\r\n        activeSub = this\r\n        try {\r\n            return this.fn()\r\n        } finally {\r\n            // \u6062\u590D\u4E4B\u524D\u7684effect\r\n            activeSub = prevSub\r\n        }\r\n    }\r\n    notify() {\r\n        this.scheduler()\r\n    }\r\n    // scheduler \u6709\u53EF\u80FD\u4F1A\u88AB\u5916\u90E8\u4F20\u5165\u7684options\u8986\u76D6\r\n    scheduler() {\r\n        // \u5728scheduler\u4E2D\u6267\u884Crun\u65B9\u6CD5\r\n        this.run()\r\n    }\r\n}\r\nexport function effect(fn, options) {\r\n    const e = new ReactiveEffect(fn)\r\n    Object.assign(e, options)\r\n    e.run()\r\n    // const runner = () => e.run()\r\n    const runner = e.run.bind(e)  //\u5B98\u65B9\u5199\u6CD5 bind\u4E5F\u521B\u5EFA\u4E86\u4E00\u4E2A\u51FD\u6570 \u540C\u4E0A\u8FF0\u5199\u6CD5\r\n    runner.effect = e\r\n    // \u4E3A\u4E86\u4FDD\u969Cthis \u8981\u8FD4\u56DE\u4E00\u4E2A\u51FD\u6570   \u540C\u65F6\u7ED9\u51FD\u6570\u52A0\u4E2A\u5C5E\u6027 effect\r\n    return runner\r\n}", "import { ReactiveEffect } from \"vue\"\r\nimport { activeSub } from \"./effect\"\r\n\r\nexport interface Link {\r\n    sub: ReactiveEffect\r\n    nextSub: Link | undefined\r\n    prevSub: Link | undefined\r\n}\r\nexport function track(dep) {\r\n    const newLink = {\r\n        sub: activeSub,\r\n        nextSub: undefined,\r\n        prevSub: undefined\r\n    }\r\n    // \u5C06\u4FDD\u5B58\u4E86\u5F53\u524Deffect\u4F9D\u8D56\u7684\u8282\u70B9\uFF0C\u6DFB\u52A0\u5230\u53CC\u5411\u94FE\u8868\r\n    if (dep.subsTail) {\r\n        // \u5982\u679C\u6709\u5C3E\u8282\u70B9 \u5C06\u5C3E\u8282\u70B9\u7684next\u6307\u5411\u65B0\u8282\u70B9 \u5C06\u65B0\u8282\u70B9\u7684prev\u6307\u5411\u5C3E\u8282\u70B9 \u5C06\u5C3E\u8282\u70B9\u6307\u9488\u6307\u5411\u65B0\u8282\u70B9\r\n        dep.subsTail.nextSub = newLink\r\n        newLink.prevSub = dep.subsTail\r\n        dep.subsTail = newLink\r\n    } else {\r\n        dep.subs = newLink\r\n        dep.subsTail = newLink\r\n    }\r\n}\r\nexport function triggerRef(dep) {\r\n    let link = dep.subs\r\n    const queueEffect = []\r\n    while (link) {\r\n        queueEffect.push(link.sub)\r\n        link = link.nextSub\r\n    }\r\n    queueEffect.forEach(effect => effect.notify())\r\n}", "import { activeSub } from \"./effect\";\r\nimport { Link, track, triggerRef } from \"./system\";\r\n\r\nenum ReactiveFlags {\r\n    IS_REF = '__v_isRef'\r\n}\r\n// \u94FE\u8868\u8282\u70B9\r\n\r\n\r\nclass RefImpl {\r\n    _value\r\n    [ReactiveFlags.IS_REF] = true // \u6807\u8BC6\r\n    subs: Link   //subscribers(\u8BA2\u9605\u8005) \u6B64\u5904\u5B58\u50A8\u5F53\u524D\u4F9D\u8D56\u7684\u526F\u4F5C\u7528\u51FD\u6570effect\r\n    // \u5C3E\u8282\u70B9\r\n    subsTail: Link\r\n    constructor(value) {\r\n        this._value = value\r\n    }\r\n    get value() {\r\n        // \u6536\u96C6\u4F9D\u8D56\r\n        if (activeSub) {\r\n            track(this)\r\n        }\r\n        return this._value\r\n    }\r\n    set value(newValue) {\r\n        this._value = newValue\r\n        triggerRef(this)\r\n    }\r\n}\r\n\r\nexport function ref(value) {\r\n    return new RefImpl(value)\r\n}\r\nexport function isRef(value) {\r\n    return !!(value && value[ReactiveFlags.IS_REF])\r\n} "],
  "mappings": ";AAAO,IAAI;AAEX,IAAM,iBAAN,MAAqB;AAAA,EACjB,YAAmB,IAAI;AAAJ;AAAA,EAEnB;AAAA,EACA,MAAM;AAEF,UAAM,UAAU;AAChB,gBAAY;AACZ,QAAI;AACA,aAAO,KAAK,GAAG;AAAA,IACnB,UAAE;AAEE,kBAAY;AAAA,IAChB;AAAA,EACJ;AAAA,EACA,SAAS;AACL,SAAK,UAAU;AAAA,EACnB;AAAA;AAAA,EAEA,YAAY;AAER,SAAK,IAAI;AAAA,EACb;AACJ;AACO,SAAS,OAAO,IAAI,SAAS;AAChC,QAAM,IAAI,IAAI,eAAe,EAAE;AAC/B,SAAO,OAAO,GAAG,OAAO;AACxB,IAAE,IAAI;AAEN,QAAM,SAAS,EAAE,IAAI,KAAK,CAAC;AAC3B,SAAO,SAAS;AAEhB,SAAO;AACX;;;AC3BO,SAAS,MAAM,KAAK;AACvB,QAAM,UAAU;AAAA,IACZ,KAAK;AAAA,IACL,SAAS;AAAA,IACT,SAAS;AAAA,EACb;AAEA,MAAI,IAAI,UAAU;AAEd,QAAI,SAAS,UAAU;AACvB,YAAQ,UAAU,IAAI;AACtB,QAAI,WAAW;AAAA,EACnB,OAAO;AACH,QAAI,OAAO;AACX,QAAI,WAAW;AAAA,EACnB;AACJ;AACO,SAAS,WAAW,KAAK;AAC5B,MAAI,OAAO,IAAI;AACf,QAAM,cAAc,CAAC;AACrB,SAAO,MAAM;AACT,gBAAY,KAAK,KAAK,GAAG;AACzB,WAAO,KAAK;AAAA,EAChB;AACA,cAAY,QAAQ,CAAAA,YAAUA,QAAO,OAAO,CAAC;AACjD;;;ACxBA,IAAM,UAAN,MAAc;AAAA,EACV;AAAA,EACA,CAAC,wBAAoB,IAAI;AAAA;AAAA,EACzB;AAAA;AAAA;AAAA,EAEA;AAAA,EACA,YAAY,OAAO;AACf,SAAK,SAAS;AAAA,EAClB;AAAA,EACA,IAAI,QAAQ;AAER,QAAI,WAAW;AACX,YAAM,IAAI;AAAA,IACd;AACA,WAAO,KAAK;AAAA,EAChB;AAAA,EACA,IAAI,MAAM,UAAU;AAChB,SAAK,SAAS;AACd,eAAW,IAAI;AAAA,EACnB;AACJ;AAEO,SAAS,IAAI,OAAO;AACvB,SAAO,IAAI,QAAQ,KAAK;AAC5B;AACO,SAAS,MAAM,OAAO;AACzB,SAAO,CAAC,EAAE,SAAS,MAAM,wBAAoB;AACjD;",
  "names": ["effect"]
}
